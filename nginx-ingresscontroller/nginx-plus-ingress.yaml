# Crear secret para el pull de la imagen de un repositorio
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyI5NzQ5Nzk2MDIyMTEuZGtyLmVjci51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9uZ2lueC1pYyI6eyJ1c2VybmFtZSI6IkFXUyIsInBhc3N3b3JkIjoiZXlKd1lYbHNiMkZrSWpvaWRsZ3pURVZ5U1ZaMVdrZDBkVWxJZUVkMk1VOTVRMWRvUm5Kd2MzWnJOMmxyUlZWSVpXazVTV3gzZW5wSVRrNXFjVFJpY0VVMVJTOU5iRGRIVDNrM1YyazBhMFJET0RJMlFrdDNWWFJoVFdGTVprcFVNMWhXTW1Jd1ZFSkdhVGN6Vld0VVMwaEZhVE4wYUVaTVpUQjZNbkoyVFRrNVNrTXlhMlo2ZEV4alpuVjJZVEJ1Wm5WeVdUZ3piVE56YnpsUFMyRlRhU3R4V0RkNVFrVnNXVXRNTld4d1dtbERXRkExVVc1dlZWSlliMk5vTVVweVJsWkxNVTg0TldZM1NuZG9SR0oyVnpSbU1qRm5UVWRITTJFdmNqSnFPRXBYWmxObWJUaFZOV3g0VTIxVlYxTnBkMGRaVEVvemJqTklOek5aWldzNGREYzVkblJQZERsbFF6RnNhRGRNVVM5NlNUUktNa1JxVjJWUFlYWkViV1I2Wm1OWmFHVXdObTlHUTJkQ1NXWTJTQzh4Y2paMlpDOWFiMEZXTkhwRFoycDBhVkVyVlhKTGR5dFFZVTkzY1ZabFJUTjViV3RCY1ZGUGJXRkZRbGxWVTFCbVpsRm5SbmgwVG5kQ1EzUnJOVFpzTmt0bVVXd3JUREU0TkVwVWVsTkVibXBQVFhsa2JXWjRUM3BSYUU5RFdpOHdUM3BSUzJseVZGSXZXSFkwYlVoeVVGcEpVSEpaYWxOc1FYRjRlRlZrTWxOeGVteFVRamxRVGxvMU9UQnFWV05UTW5GbGNuQlpjSFJpWVc5MGFFWktRWHBrUjFkd1JHZE9iVkEzV2xCYWEwVjBVVzRyVFdOaFNsRk5aVGt5YkdWUVUyZG5jemh1VkZSdlIxQk5LekpwY1ZwbVdFOTZiVmxoSzBjdk5ITkZNRzF3VDNnMlIyTlhVbkExUmpVME4zSnNVbXBsWTFWTU1scE1SRGMwYzI1UUsxbEVVVTlyWXpZdlFVMXlhRVUxWkhGcVJTczNOSFZ6YTA1R2NrRlZMMEYzY1Uxd2IwMVlXUzlhU0RFeVNWbG1WR1J6UzJwSFIySjRZamxIVTNvMWIwSklVbk5NZEdweWFrVXlZMnN6VjAxRGRXeEhWakUwYzBWTmFtaFdZM0pyY21SclN6ZEJUazVhZHpNNGJscGxLemg0WTJRMFl6WjRlVzl3UTFsV2NHcEJTSEJKU2sxUU0wMW1ibHBsVm5wVkwwTndkM1JrZGpGRlJYVjBWVFZ6ZW1JMWN6Tldia1p1Y1ZZM1RteE5SMHN2UTNGZGtvMGEwTkJWV05tYUZGbGRFZE1TamhZTVZsWmJESlVVMjF5UkRReVRrMVdNR2xOTUZsUGRFODFRblV5ZEhGNVRHTm1XR05WZG01MWF6Qk1jM2N3WkVvd05saHJjWE5EUVhVM1lWSnhSbGxZZERGcFIyUk1VakFyUTJSYWJEZDNVa2hTVURaNk9FTkVkV1JJYkZkdVUzVmpSemxhVUN0bVpWY3ZiR2hCY0M5dk1USXhNVzR5UVZwUGEzUllaQ3R1YjBoamVYRTVTa2RaWlhrM1IzSnpTVWR3VlRGNFMwWk1XRGRvWkU5RFowVXdjWEZFVUdWQmQxaEJkMnhzY0dWaU1VTnlSbU0xYldsWEt6aFFUakZQZUc0MmVUbFhlV3h4WkdGcFpYaG5OVUpUZEVwc1JGVlRSRk40SWl3aVpHRjBZV3RsZVNJNklrRlJSVUpCU0doaVRUQllVRlZrWlRSeWEwMHpTVzgxZEdNd05EQnRTazlzU0U4eVkzTmlVVzl4Yld0S1ZYcFpRMU5SUVVGQlNEUjNaa0ZaU2t0dldrbG9kbU5PUVZGalIyOUhPSGRpVVVsQ1FVUkNiMEpuYTNGb2EybEhPWGN3UWtKM1JYZElaMWxLV1VsYVNVRlhWVVJDUVVWMVRVSkZSVVJIVnpRM1dYSjJVbkY0UVZoSFYyMXpRVWxDUlVsQk4xQXZSVEJYVG5KU2VDdDVNR1JaYUUxUGFESXZVR3BhYTNGRVoyNVhOa3MwYUdkcGJGUnBaVWd5T1c4M1ozZGlOSFJaYWtVelluSlBOM3BoTVhoSE5GZHJWVWhST1RGMWRHdEZTREp6YldjOUlpd2lkbVZ5YzJsdmJpSTZJaklpTENKMGVYQmxJam9pUkVGVVFWOUxSVmtpTENKbGVIQnBjbUYwYVc5dUlqb3hOamczTnpnNU56azFmUT09IiwiYXV0aCI6IlFWZFRPbVY1U25kWldHeHpZakpHYTBscWIybGtiR2Q2VkVWV2VWTldXakZYYTJRd1pGVnNTV1ZGWkRKTlZUazFVVEZrYjFKdVNuZGpNMXB5VGpKc2NsSldWa2xhVjJzMVUxZDRNMlZ1Y0VsVWF6VnhZMVJTYVdORlZURlNVemxPWWtSa1NGUXphek5XTW1zd1lUQlNSRTlFU1RKUmEzUXpWbGhTYUZSWFJrMWFhM0JWVFRGb1YwMXRTWGRXUlVwSFlWUmplbFpYZEZWVE1HaEdZVlJPTUdGRldrMWFWRUkyVFc1S01sUlVhelZUYTAxNVlUSmFObVJGZUdwYWJsWXlXVlJDZFZwdVZubFhWR2Q2WWxST2VtSjZiRkJUTWtaVVlWTjBlRmRFWkRWUmExWnpWMVYwVFU1WGVIZFhiV3hFVjBaQk1WVlhOWFpXVmtwWllqSk9iMDFWY0hsU2JGcE1UVlU0TkU1WFdUTlRibVJ2VWtkS01sWjZVbTFOYWtadVZGVmtTRTB5UlhaamFrcHhUMFZ3V0Zwc1RtMWlWR2hXVGxkNE5GVXlNVlpXTVU1d1pEQmtXbFJGYjNwaWFrNUpUbnBPV2xwWGN6UmtSR00xWkc1U1VHUkViR3hSZWtaellVUmtUVlZUT1RaVFZGSkxUV3RTY1ZZeVZsQlpXRnBGWWxkU05scHRUbHBoUjFWM1RtMDVSMUV5WkVOVFYxa3lVME00ZUdOcVdqSmFRemxoWWpCR1YwNUljRVJhTW5Bd1lWWkZjbFpZU2t4a2VYUlJXVlU1TTJOV1dteFNWRTQxWWxkMFFtTldSbEJpVjBaR1VXeHNWbFV4UW0xYWJFWnVVbTVvTUZSdVpFTlJNMUp5VGxSYWMwNXJkRzFWVjNkeVZFUkZORTVGY0ZWbGJFNUZZbTF3VUZSWWJHdGlWMW8wVkROd1VtRkZPVVJYYVRoM1ZETndVbE15YkhsV1JrbDJWMGhaTUdKVmFIbFZSbkJLVlVoS1dtRnNUbk5SV0VZMFpVWldhMDFzVG5obGJYaFZVV3BzVVZSc2J6RlBWRUp4VmxkT1ZFMXVSbXhqYmtKYVkwaFNhVmxYT1RCaFJWcExVVmh3YTFJeFpIZFNSMlJQWWxaQk0xZHNRbUZoTUZZd1ZWYzBjbFJYVG1oVGJFWk9XbFJyZVdKSFZsRlZNbVJ1WTNwb2RWWkdVblpTTVVKT1MzcEtjR05XY0cxWFJUazJZbFpzYUVzd1kzWk9TRTVHVFVjeGQxUXpaekpTTWs1WVZXNUJNVkpxVlRCT00wcHpWVzF3YkZreFZrMU5iSEJOVWtSak1HTXlOVkZMTVd4RlZWVTVjbGw2V1haUlZURjVZVVZWTVZwSVJuRlNVM016VGtoV2VtRXdOVWRqYTBaV1REQkdNMk5WTVhkaU1ERlpWMU01WVZORVJYbFRWbXh0VmtkU2VsTXljRWhTTWtvMFdXcHNTRlV6YnpGaU1FcEpWVzVPVFdSSGNIbGhhMVY1V1RKemVsWXdNVVJrVjNoSVZtcEZNR013Vms1aGJXaFhXVE5LY21OdFVuSlRlbVJDVkdzMVlXUjZUVFJpYkhCc1MzcG9ORmt5VVRCWmVsbzBaVmM1ZDFFeGJGZGpSM0JDVTBoQ1NsTnJNVkZOTURGdFlteHdiRlp1Y0ZaTU1FNTNaRE5TYTJScVJrWlNXRll3VmxSV2VtVnRTVEZqZWs1WFltdGFkV05XV1ROVWJYaE9VakJ6ZGxFelJtUnJiekJoTUU1Q1ZsZE9iV0ZHUm14a1JXUk5VMnBvV1UxV2JGcGlSRXBWVlRJeGVWSkVVWGxVYXpGWFRVZHNUazFHYkZCa1JUZ3hVVzVWZVdSSVJqVlVSMDV0VjBkT1ZtUnROVEZoZWtKTll6TmpkMXBGYjNkT2JHaHlZMWhPUkZGWVZUTlpWa3A0VW14c1dXUkVSbkJTTWxKTlZXcEJjbEV5VW1GaVJHUXpWV3RvVTFWRVdqWlBSVTVGWkZkU1NXSkdaSFZWTTFacVVucHNZVlZEZEcxYVZtTjJZa2RvUW1ORE9YWk5WRWw0VFZjMGVWRldjRkJoTTFKWldrTjBkV0l3YUdwbFdFVTFVMnRrV2xwWWF6TlNNMHA2VTFWa2QxWlVSalJUTUZwTlYwUmtiMXBGT1VSYU1GVjNZMWhHUlZWSFZrSmtNV2hDWkRKNGMyTkhWbWxOVlU1NVVtMU5NV0pYYkZoTGVtaFJWR3BHVUdWSE5ESmxWR3hZWlZkNGVGcEhSbkJhV0dodVRsVktWR1JGY0hOU1JsWlVVa1pPTkVscGQybGFSMFl3V1ZkMGJHVlRTVFpKYTBaU1VsVktRbE5IYUdsVVZFSlpWVVpXYTFwVVVubGhNREI2VTFjNE1XUkhUWGRPUkVKMFUyczVjMU5GT0hsWk0wNXBWVmM1ZUdKWGRFdFdXSEJhVVRGT1VsRlZSa0pUUkZJeldtdEdXbE5yZEhaWGEyeHZaRzFPVDFGV1JtcFNNamxJVDBoa2FWVlZiRU5SVlZKRFlqQktibUV6Um05aE1teElUMWhqZDFGclNqTlNXR1JKV2pGc1MxZFZiR0ZUVlVaWVZsVlNRMUZWVmpGVVZVcEdVbFZTU0ZaNlVUTlhXRW95Vlc1R05GRldhRWhXTWpGNlVWVnNRMUpWYkVKT01VRjJVbFJDV0ZSdVNsTmxRM1ExVFVkU1dtRkZNVkJoUkVsMlZVZHdZV0V6UmtWYU1qVllUbXR6TUdGSFpIQmlSbEp3V2xWbmVVOVhPRE5hTTJScFRraFNXbUZyVlhwWmJrcFFUak53YUUxWWFFaE9SbVJ5VmxWb1VrOVVSakZrUjNSR1UwUktlbUpYWXpsSmFYZHBaRzFXZVdNeWJIWmlhVWsyU1dwSmFVeERTakJsV0VKc1NXcHZhVkpGUmxWUlZqbE1VbFpyYVV4RFNteGxTRUp3WTIxR01HRlhPWFZKYW05NFRtcG5NMDU2WnpWT2Vtc3habEU5UFE9PSJ9fX0=
kind: Secret
metadata:
  name: regcred
  namespace: nginx-ingress
type: kubernetes.io/dockerconfigjson
---
# Instalacion de los pods de Nginx Ingress Controller como daemonset
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: nginx-ingress
  namespace: nginx-ingress
spec:
  selector:
    matchLabels:
      app: nginx-ingress
  template:
    metadata:
      labels:
        app: nginx-ingress
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9113"
    spec:
      serviceAccountName: nginx-ingress
      #automountServiceAccountToken: true
      imagePullSecrets:
        - name: regcred 
      containers: 
        - image: 974979602211.dkr.ecr.us-east-1.amazonaws.com/nginx-ic:3.0.1
          imagePullPolicy: Always
          name: nginx-plus-ingress
          ports:
            - name: http
              containerPort: 80
              hostPort: 80
            - name: https
              containerPort: 443
              hostPort: 443
            - name: readiness-port
              containerPort: 8081
            - name: prometheus
              containerPort: 9113
            - name: dashboard
              containerPort: 8080
          readinessProbe:
            httpGet:
              path: /nginx-ready
              port: readiness-port
            periodSeconds: 1
          securityContext:
            allowPrivilegeEscalation: true
            runAsUser: 101 #nginx
            capabilities:
              drop:
                - ALL
              add:
                - NET_BIND_SERVICE
          env:
            - name: POD_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
          args:
            - -nginx-plus
            - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config
            - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret
            #- -nginx-status-allow-cidrs=0.0.0.0/0
              #- -nginx-status-port=9898
              #- -enable-app-protect
            #- -enable-app-protect-dos
            #- -v=3 # Enables extensive logging. Useful for troubleshooting.
            #- -report-ingress-status
            #- -external-service=nginx-ingress
            - -enable-prometheus-metrics
            - -enable-latency-metrics
            #- -global-configuration=$(POD_NAMESPACE)/nginx-configuration













































































































